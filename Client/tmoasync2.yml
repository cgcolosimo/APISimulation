schema: SimV1
name: default

connections:
  - name: tmocon
    endpoint: http://localhost:33633
    listen: false
  
  - name: replytoin
    port: 33633
    listen: true

  - name: google
    listen: false
    endpoint: http://www.poogle.com

services:
  - name: tmob Multi Out
    steps:
      - name: Outbound test
        direction: Out
        to: tmocon
        message:
          payload: {"message" : "Sending outboud message, please respond to this endpoint",
                     "Endpoint": "http://www.google.com" 
                    }
      
      - direction: In
        verify:
            - value: message 1
      
      - direction: In
        verify:
            - value: message 2
      
      - direction: In
        verify:
            - value: message 3



  - name: tmob Multi Mock
    steps:
    - name: Inbound Mock response 1
      direction: In
      from: replytoin
      buffer:
        - jsonPath: Endpoint
          name: theendpoint

    - direction: Out
      name: Inbound Mock response 2
      message:
        payload: |-
          Call 1

      
    - direction: Out
      name: Inbound Mock response 3
      insert:
        - type: Connection
          property: Endpoint
          value: '{b[theendpoint]}'
      to: google
      message:
        payload: |-
          Call 2
        delay: 5000


    - direction: Out
      name: Inbound Mock response 4
      insert:
        - type: Connection
          property: Endpoint
          value: '{b[theendpoint]}'
      to: google
      message:
        payload: |-
          Call 3
        delay: 5000